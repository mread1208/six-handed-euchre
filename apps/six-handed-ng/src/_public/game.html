<!DOCTYPE html>
<html>
    <head>
        <title>Game</title>
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
            integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
            crossorigin="anonymous"
        />
    </head>
    <body class="container">
        <div class="page-header">
            <h1>6-Handed Euchre Game {{GAME NUMBER HERE}}</h1>
        </div>

        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="/">Home</a></li>
                        <li><a href="/signup">Sign Up</a></li>
                        <li><a href="/game-boards">Games</a></li>
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="/login">Log In</a></li>
                        <li><a href="/logout">Log Out</a></li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>

        <div class="container row">
            <h1>You're in a game!</h1>
            <p>Hurry Tom you're taking too damn long!</p>
        </div>
        <div class="container row">
            <form action="" id="messageForm">
                <input type="text" value="" id="message" />
                <button class="btn btn-primary">Submit Message</button>
            </form>
            <ul id="messages"></ul>
        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            (function() {
                const socket = io.connect("http://localhost:4300");
                const msgForm = document.querySelector("#messageForm");
                const messagesList = document.querySelector("#messages");

                function getCookie(cname) {
                    var name = cname + "=";
                    var ca = document.cookie.split(";");
                    for (var i = 0; i < ca.length; i++) {
                        var c = ca[i];
                        while (c.charAt(0) == " ") {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) == 0) {
                            return c.substring(name.length, c.length);
                        }
                    }
                    return "";
                }

                msgForm.addEventListener("submit", e => {
                    e.preventDefault();
                    socket.emit(`chat_message`, e.target.message.value);
                    e.target.name.value = "";
                    return false;
                });

                socket.on(`chat_message`, msg => {
                    const listItem = document.createElement(`li`);
                    listItem.textContent = msg;
                    messagesList.appendChild(listItem);
                });

                fetch(`http://localhost:4300/get-user`)
                    .then(response => {
                        return response.json();
                    })
                    .then(data => {
                        socket.emit(`chat_message`, `${data.username} joined`);
                    });
            })();
        </script>
    </body>
</html>
